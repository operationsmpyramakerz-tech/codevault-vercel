<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Create Order â€” Products</title>
<link href="/css/style.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" rel="stylesheet"/>
<script src="https://unpkg.com/feather-icons"></script>
  <style>
    .tabs-bar{display:flex;gap:10px;margin:8px 0 0}
    .tab-btn{display:inline-flex;align-items:center;gap:8px;padding:.6rem 1rem;border-radius:999px;border:1px solid #E5E7EB;background:#F3F4F6;color:#374151;text-decoration:none;font-weight:700}
    .tab-btn.active{background:#111827;color:#fff;border-color:#111827;box-shadow:0 8px 16px rgba(0,0,0,.18)}
  </style>
</head>
<body>
<script>
    (function() {
      try {
        if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
          document.body.classList.add('sidebar-mini');
        }
      } catch(e) {}
    })();
  </script>
<div class="app-container">
<aside class="sidebar">
<div class="sidebar-header">
<h2>Dashboard</h2>
<button aria-expanded="true" aria-label="Toggle sidebar" class="sidebar-toggle" id="sidebar-toggle">
<i data-feather="chevrons-left"></i>
</button>
</div>
<!-- Sidebar: flat links -->
<nav class="sidebar-nav">
<ul class="nav-list">
<li>
<a class="nav-link" href="/orders">
<i data-feather="list"></i>
<span class="nav-label">Current Orders</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/requested">
<i data-feather="users"></i>
<span class="nav-label">Schools Requested Orders</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/assigned">
<i data-feather="user-check"></i>
<span class="nav-label">Storage</span>
</a>
</li>
<li>
<a class="nav-link active" href="/orders/new">
<i data-feather="plus-circle"></i>
<span class="nav-label">Create New Order</span>
</a>
</li>
<li>
<a class="nav-link" href="/stocktaking">
<i data-feather="archive"></i>
<span class="nav-label">Stocktaking</span>
</a>
</li>
<li><a class="nav-link" href="/logistics"><i data-feather="truck"></i><span class="nav-label">Logistics</span></a></li><li>
<a class="nav-link" href="/funds">
<i data-feather="dollar-sign"></i>
<span class="nav-label">Funds</span>
</a>
</li>
<li>
  <a class="nav-link" href="/orders/sv-orders">
    <i data-feather="award"></i>
    <span class="nav-label">S.V schools orders</span>
  </a>
</li>
    <li>
  <a class="nav-link" href="/new-report-request.html">
    <i data-feather="folder-plus"></i>
    <span class="nav-label">New Report / Request</span>
  </a>
</li>
</ul>
</nav>
<div class="sidebar-footer">
<button class="logout-btn" id="logoutBtn"><i data-feather="log-out"></i> Logout</button>
</div>
</aside>
<div class="main-content">
<header class="main-header">
<div class="header-row1">
<div class="left">
<div aria-live="polite" class="greeting-pill">
<span class="greeting-avatar">
<img alt="Hi icon" src="/images/greeting-icon.png"/>
</span>
<div class="greet-text">
<div class="greet-title">Hi, <span data-username="">...</span> ðŸ‘‹</div>
<div class="greet-sub">Start your day with operations</div>
</div>
</div>
</div>
<div class="right topbar-right">
<a aria-label="My account" class="account-mini" href="/account" title="My account">
<span class="ico-circle"><img alt="Logo" src="/images/logo.png"/></span>
<span class="label">My account</span>
</a>
</div>
</div>
<div class="header-row2">
<h1 class="page-title">Create New Order</h1>
          <div class="tabs-bar">
            <a class="tab-btn" id="tab-request" href="/orders/new/products?mode=request">Request Additional Components</a>
            <a class="tab-btn" id="tab-damage"  href="/orders/new/products?mode=damage">Report Damage Components</a>
          </div>
</div>
</header>
<main class="container create-order-layout">
<section class="page-stepper">
<ol aria-label="Order steps" class="stepper" id="order-stepper">
<li class="step completed" data-step="1">
<span class="circle">1</span><span class="label">Order Details</span><span class="bar"></span>
</li>
<li class="step active" data-step="2">
<span class="circle">2</span><span class="label">Products</span><span class="bar"></span>
</li>
<li class="step" data-step="3"><span class="circle">3</span><span class="label">Review</span></li>
</ol>
</section>
<section class="card form-card" id="panel-request" hidden>
<div class="form-row-headers">
<span>Product</span>
<span>Quantity</span>
<span></span>
</div>
<div id="products-container"></div>
<div class="form-actions">
<button class="btn-outline-pill" id="addProductBtn" type="button">
<i data-feather="plus"></i><span>Add Another Product</span>
</button>
<div style="display:flex; gap:10px;">
<a class="nav-link" href="/orders/new" style="padding:.75rem 1rem; border:1px solid #D1D5DB; border-radius:12px; text-decoration:none; color:#374151; background:#fff;">
              Back
            </a>
<button class="submit-btn elevated" id="nextReviewBtn" type="button">Next: Review</button>
</div>
</div>
<div class="tip-callout" role="note">
<i data-feather="info"></i><span>
<strong>Tip:</strong>: Use search to filter products quickly.</span>
</div>
</section>
        <section class="card form-card" id="panel-damage" hidden>
          <h2>Report Damage Components</h2>
          <p class="muted">Coming soon: damaged component form & uploads.</p>
          <div style="margin-top:.75rem;">
            <a class="btn-3d btn-3d-blue" href="/orders/new?mode=damage">Back to Details</a>
          </div>
        </section>
</main>
</div>
</div>
<script>feather.replace();</script>
<script src="/js/common-ui.js"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="/js/order-products.step.js"></script>
<script>
(function(){
  const mode = (new URLSearchParams(location.search).get('mode')||'request').toLowerCase();
  const isDamage = mode==='damage';
  const reqTab = document.getElementById('tab-request');
  const dmgTab = document.getElementById('tab-damage');
  const reqPanel = document.getElementById('panel-request');
  const dmgPanel = document.getElementById('panel-damage');
  if(reqTab && dmgTab && reqPanel && dmgPanel){
    reqTab.classList.toggle('active', !isDamage);
    dmgTab.classList.toggle('active',  isDamage);
    reqPanel.hidden = isDamage;
    dmgPanel.hidden = !isDamage;
  }
  if(!isDamage){
    const next = document.getElementById('nextReviewBtn');
    next && next.addEventListener('click', function(){
      const url = new URL('/orders/new/review', location.origin);
      url.searchParams.set('mode','request');
      location.href = url.toString();
    });
    // back link: force mode=request
    const back = document.querySelector('a.nav-link[href="/orders/new"]');
    if(back){ back.href = '/orders/new?mode=request'; }
  }
})();
</script>
</body>
</html>
