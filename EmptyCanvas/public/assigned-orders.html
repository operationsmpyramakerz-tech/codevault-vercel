<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Storage</title>
<link href="/css/style.css" rel="stylesheet"/>
<script src="https://unpkg.com/feather-icons"></script>
<style>
  /* Selected shadow for the top 3 stat buttons (matches app's soft card shadow) */
  .stat.stat--btn.active {
    box-shadow: 0 6px 18px rgba(2, 16, 28, 0.08), 0 2px 6px rgba(2, 16, 28, 0.06);
    border-color: rgba(2, 16, 28, 0.08);
  }
  /* Keep keyboard focus visible too */
  .stat.stat--btn:focus-visible {
    outline: 3px solid rgba(2, 125, 255, 0.4);
    outline-offset: 2px;
  }
</style>
</head>
<body>
<script>
    (function() {
      try {
        if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
          document.body.classList.add('sidebar-mini');
        }
      } catch(e) {}
    })();
  </script>
<div class="app-container">
<aside class="sidebar">
<div class="sidebar-header">
<h2>Dashboard</h2>
<button aria-expanded="true" aria-label="Toggle sidebar" class="sidebar-toggle" id="sidebar-toggle">
<i data-feather="chevrons-left"></i>
</button>
</div>
<nav class="sidebar-nav">
<ul class="nav-list">
<li>
<a class="nav-link" href="/orders">
<i data-feather="list"></i>
<span class="nav-label">Current Orders</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/requested">
<i data-feather="users"></i>
<span class="nav-label">Schools Requested Orders</span>
</a>
</li>
<li>
<a class="nav-link active" href="/orders/assigned">
<i data-feather="user-check"></i>
<span class="nav-label">Storage</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/new">
<i data-feather="plus-circle"></i>
<span class="nav-label">Create New Order</span>
</a>
</li>
<li>
<a class="nav-link" href="/stocktaking">
<i data-feather="archive"></i>
<span class="nav-label">Stocktaking</span>
</a>
</li>
<li><a class="nav-link" href="/logistics"><i data-feather="truck"></i><span class="nav-label">Logistics</span></a></li><li>
<a class="nav-link" href="/funds">
<i data-feather="dollar-sign"></i>
<span class="nav-label">Funds</span>
</a>
</li>
</ul>
</nav>
<div class="sidebar-footer">
<button class="logout-btn" id="logoutBtn"><i data-feather="log-out"></i> Logout</button>
</div>
</aside>
<div class="main-content">
<header class="main-header">
<div class="header-row1">
<div class="left">
<div aria-live="polite" class="greeting-pill">
<span class="greeting-avatar">
<img alt="Hi icon" src="/images/greeting-icon.png"/>
</span>
<div class="greet-text">
<div class="greet-title">Hi, <span data-username="">...</span> üëã</div>
<div class="greet-sub">Your storage overview</div>
</div>
</div>
<div class="searchbar" id="assigned-searchbar" role="search">
<i data-feather="search"></i>
<input aria-label="Search assigned items" id="assignedSearch" placeholder="Search items in storage..." type="search"/>
</div>
</div>
<div class="right topbar-right">
<a aria-label="My account" class="account-mini" href="/account" title="My account">
<span class="ico-circle"><img alt="Logo" src="/images/logo.png"/></span>
<span class="label">My account</span>
</a>
</div>
</div>
<div class="header-row2">
<h1 class="page-title">Storage</h1>
</div>
</header>
<main class="container-full-width">
<!-- == STAT FILTERS AS BUTTONS == -->
<div class="stats">
<button aria-pressed="true" class="stat stat--btn active" data-filter="all" id="st-btn-total" type="button">
<div class="stat__label">Total assigned</div>
<div class="stat__value" id="st-total">0</div>
</button>
<button aria-pressed="false" class="stat stat--btn" data-filter="prepared" id="st-btn-full" type="button">
<div class="stat__label">Fully available</div>
<div class="stat__value stat__value--ok" id="st-full">0</div>
</button>
<button aria-pressed="false" class="stat stat--btn" data-filter="missing" id="st-btn-missing" type="button">
<div class="stat__label">Missing</div>
<div class="stat__value stat__value--warn" id="st-missing">0</div>
</button>
</div>
<div class="muted" id="assigned-empty" style="display:none;"> There are  no ongoing requests</div>
<div class="assigned-grid" id="assigned-grid"></div>
</main>
</div>
</div>
<div aria-labelledby="partial-popover-title" aria-modal="true" class="popover hidden" id="partial-popover" role="dialog">
<div class="popover__body">
<div class="popover__title" id="partial-popover-title">
<i data-feather="edit-3"></i>
        Set available quantity
      </div>
<label class="popover__label">Available</label>
<input class="input" id="popover-input" min="0" step="1" type="number"/>
<small class="hint" id="popover-hint"></small>
<div class="popover__actions">
<button class="btn btn-outline" data-pop="cancel">Cancel</button>
<button class="btn btn-primary" data-pop="save">Save</button>
</div>
</div>
</div>
<script>feather.replace();</script>
<script src="/js/common-ui.js"></script>
<script src="/js/assigned-orders.js"></script>
<script>
  // Keep the selected shadow in sync with the current filter
  (function () {
    const bar = document.querySelector('.stats');
    if (!bar) return;

    function setActive(btn) {
      // toggle aria-pressed and .active on the three buttons
      bar.querySelectorAll('.stat--btn').forEach(b => {
        const isActive = b === btn;
        b.setAttribute('aria-pressed', String(isActive));
        b.classList.toggle('active', isActive);
      });
    }

    // initialize from any aria-pressed=true
    const initiallyPressed = bar.querySelector('.stat--btn[aria-pressed="true"]');
    if (initiallyPressed) setActive(initiallyPressed);

    bar.addEventListener('click', (e) => {
      const btn = e.target.closest && e.target.closest('.stat--btn');
      if (!btn) return;
      setActive(btn);
      // let assigned-orders.js handle the actual filtering logic
    });
  })();
</script>
<!-- ===== Mark Received: Receipt Upload Modal (DROP-IN) ===== -->
<div id="receipt-modal" class="modal-overlay" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-header">
      <h3 class="modal-title">Attach receipt image</h3>
      <button type="button" class="modal-close" id="receipt-modal-close" aria-label="Close">√ó</button>
    </div>

    <form id="receipt-form">
      <div class="modal-body">
        <!-- Order info (filled by JS) -->
        <input type="hidden" id="receipt-order-id" name="orderId" />
        <p class="muted" id="receipt-order-title">Order: ‚Äî</p>

        <label for="receipt-file" class="form-label">Receipt Image (PNG/JPG)</label>
        <input id="receipt-file" name="receiptFile" type="file" accept="image/*" required />

        <div id="receipt-hint" class="hint">
          Only one image is needed. Max ~5MB recommended.
        </div>

        <div id="receipt-alert" class="alert hidden"></div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-light" id="receipt-cancel">Cancel</button>
        <button type="submit" class="btn btn-primary" id="receipt-submit">Submit</button>
      </div>
    </form>
  </div>
</div>

<style>
  /* Lightweight styles, ŸÑÿß ÿ™ÿ∫ŸäŸëÿ± ÿ¥ŸÉŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿπÿßŸÖ */
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:9999}
  .modal-overlay.show{display:flex}
  .modal-card{width:min(520px,92vw);background:#fff;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.15);overflow:hidden}
  .modal-header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid #eee}
  .modal-title{margin:0;font-size:1.05rem;font-weight:700}
  .modal-close{background:transparent;border:0;font-size:22px;line-height:1;cursor:pointer}
  .modal-body{padding:16px 18px}
  .modal-footer{display:flex;gap:.5rem;justify-content:flex-end;padding:12px 18px;border-top:1px solid #eee}
  .form-label{display:block;font-weight:600;margin-bottom:6px}
  #receipt-file{display:block;width:100%;padding:10px;border:1px solid #e0e0e0;border-radius:10px;background:#fafafa}
  .hint{font-size:.85rem;color:#666;margin-top:8px}
  .muted{color:#6b7280;margin:.25rem 0 .75rem}
  .alert{margin-top:10px;border-radius:10px;padding:10px 12px;font-size:.92rem}
  .alert.success{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
  .alert.error{background:#fef2f2;color:#991b1b;border:1px solid #fecaca}
  .btn{border-radius:10px;padding:10px 14px;border:1px solid transparent;cursor:pointer;font-weight:600}
  .btn-light{background:#f3f4f6;color:#111827;border-color:#e5e7eb}
  .btn-primary{background:#e76f2c;color:#fff}
</style>
<!-- ===== /Mark Received Modal ===== -->
</body>
</html>
