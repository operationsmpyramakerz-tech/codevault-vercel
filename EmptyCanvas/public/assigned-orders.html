<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Storage</title>
<link href="/css/style.css" rel="stylesheet"/>
<script src="https://unpkg.com/feather-icons"></script>
<style>
  /* Selected shadow for the top 3 stat buttons (matches app's soft card shadow) */
  .stat.stat--btn.active {
    box-shadow: 0 6px 18px rgba(2, 16, 28, 0.08), 0 2px 6px rgba(2, 16, 28, 0.06);
    border-color: rgba(2, 16, 28, 0.08);
  }
  /* Keep keyboard focus visible too */
  .stat.stat--btn:focus-visible {
    outline: 3px solid rgba(2, 125, 255, 0.4);
    outline-offset: 2px;
  }
</style>
</head>
<body>
<script>
    (function() {
      try {
        if (window.innerWidth > 768 && localStorage.getItem('ui.sidebarMini') === '1') {
          document.body.classList.add('sidebar-mini');
        }
      } catch(e) {}
    })();
  </script>
<div class="app-container">
<aside class="sidebar">
<div class="sidebar-header">
<h2>Dashboard</h2>
<button aria-expanded="true" aria-label="Toggle sidebar" class="sidebar-toggle" id="sidebar-toggle">
<i data-feather="chevrons-left"></i>
</button>
</div>
<nav class="sidebar-nav">
<ul class="nav-list">
<li>
<a class="nav-link" href="/orders">
<i data-feather="list"></i>
<span class="nav-label">Current Orders</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/requested">
<i data-feather="users"></i>
<span class="nav-label">Schools Requested Orders</span>
</a>
</li>
<li>
<a class="nav-link active" href="/orders/assigned">
<i data-feather="user-check"></i>
<span class="nav-label">Storage</span>
</a>
</li>
<li>
<a class="nav-link" href="/orders/new">
<i data-feather="plus-circle"></i>
<span class="nav-label">Create New Order</span>
</a>
</li>
<li>
<a class="nav-link" href="/stocktaking">
<i data-feather="archive"></i>
<span class="nav-label">Stocktaking</span>
</a>
</li>
<li><a class="nav-link" href="/logistics"><i data-feather="truck"></i><span class="nav-label">Logistics</span></a></li><li>
<a class="nav-link" href="/funds">
<i data-feather="dollar-sign"></i>
<span class="nav-label">Funds</span>
</a>
</li>
</ul>
</nav>
<div class="sidebar-footer">
<button class="logout-btn" id="logoutBtn"><i data-feather="log-out"></i> Logout</button>
</div>
</aside>
<div class="main-content">
<header class="main-header">
<div class="header-row1">
<div class="left">
<div aria-live="polite" class="greeting-pill">
<span class="greeting-avatar">
<img alt="Hi icon" src="/images/greeting-icon.png"/>
</span>
<div class="greet-text">
<div class="greet-title">Hi, <span data-username="">...</span> ðŸ‘‹</div>
<div class="greet-sub">Your storage overview</div>
</div>
</div>
<div class="searchbar" id="assigned-searchbar" role="search">
<i data-feather="search"></i>
<input aria-label="Search assigned items" id="assignedSearch" placeholder="Search items in storage..." type="search"/>
</div>
</div>
<div class="right topbar-right">
<a aria-label="My account" class="account-mini" href="/account" title="My account">
<span class="ico-circle"><img alt="Logo" src="/images/logo.png"/></span>
<span class="label">My account</span>
</a>
</div>
</div>
<div class="header-row2">
<h1 class="page-title">Storage</h1>
</div>
</header>
<main class="container-full-width">
<!-- == STAT FILTERS AS BUTTONS == -->
<div class="stats">
<button aria-pressed="true" class="stat stat--btn active" data-filter="all" id="st-btn-total" type="button">
<div class="stat__label">Total assigned</div>
<div class="stat__value" id="st-total">0</div>
</button>
<button aria-pressed="false" class="stat stat--btn" data-filter="prepared" id="st-btn-full" type="button">
<div class="stat__label">Fully available</div>
<div class="stat__value stat__value--ok" id="st-full">0</div>
</button>
<button aria-pressed="false" class="stat stat--btn" data-filter="missing" id="st-btn-missing" type="button">
<div class="stat__label">Missing</div>
<div class="stat__value stat__value--warn" id="st-missing">0</div>
</button>
</div>
<div class="muted" id="assigned-empty" style="display:none;"> There are  no ongoing requests</div>
<div class="assigned-grid" id="assigned-grid"></div>
</main>
</div>
</div>
<div aria-labelledby="partial-popover-title" aria-modal="true" class="popover hidden" id="partial-popover" role="dialog">
<div class="popover__body">
<div class="popover__title" id="partial-popover-title">
<i data-feather="edit-3"></i>
        Set available quantity
      </div>
<label class="popover__label">Available</label>
<input class="input" id="popover-input" min="0" step="1" type="number"/>
<small class="hint" id="popover-hint"></small>
<div class="popover__actions">
<button class="btn btn-outline" data-pop="cancel">Cancel</button>
<button class="btn btn-primary" data-pop="save">Save</button>
</div>
</div>
</div>
<script>feather.replace();</script>
<script src="/js/common-ui.js"></script>
<script src="/js/assigned-orders.js"></script>
<script>
  // Keep the selected shadow in sync with the current filter
  (function () {
    const bar = document.querySelector('.stats');
    if (!bar) return;

    function setActive(btn) {
      // toggle aria-pressed and .active on the three buttons
      bar.querySelectorAll('.stat--btn').forEach(b => {
        const isActive = b === btn;
        b.setAttribute('aria-pressed', String(isActive));
        b.classList.toggle('active', isActive);
      });
    }

    // initialize from any aria-pressed=true
    const initiallyPressed = bar.querySelector('.stat--btn[aria-pressed="true"]');
    if (initiallyPressed) setActive(initiallyPressed);

    bar.addEventListener('click', (e) => {
      const btn = e.target.closest && e.target.closest('.stat--btn');
      if (!btn) return;
      setActive(btn);
      // let assigned-orders.js handle the actual filtering logic
    });
  })();
</script>
</body>
</html>
