<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Logistics</title>

    <!-- Main styles (اتأكد إن المسار ده شغال عندك) -->
    <link id="main-style" rel="stylesheet" href="/css/style.css?v=20251012" />

    <!-- Feather icons (اختياري) -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
      /* تبويب العدّادات أعلى الصفحة – ظل للتبويب النشط فقط */
      .tabs-bar{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin:18px 0 8px}
      .tab-card{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px;border-radius:14px;background:#fff;border:1px solid rgba(15,23,42,.06);transition:box-shadow .2s,transform .06s;cursor:pointer;user-select:none}
      .tab-card:hover{transform:translateY(-1px)}
      .tab-card.active,.tab-card[aria-pressed="true"]{box-shadow:0 10px 28px rgba(2,8,23,.12)}
      .tab-title{font-size:14px;color:#6b7280;margin-bottom:6px}
      .tab-value{font-size:22px;font-weight:700;color:#0f172a}
      /* شبكة الكروت */
      .cards-grid{display:flex;flex-direction:column;gap:18px}
    </style>
  </head>

  <body class="page">
    <div class="layout">
      <!-- ===== Sidebar ===== -->
      <aside class="sidebar">
        <div class="sidebar__inner">
          <nav class="sidebar-nav">
            <a href="/orders" class="nav-link">
              <i data-feather="list"></i><span>Current Orders</span>
            </a>
            <a href="/orders/requested" class="nav-link">
              <i data-feather="inbox"></i><span>Schools Requested Orders</span>
            </a>
            <a href="/orders/assigned" class="nav-link">
              <i data-feather="package"></i><span>Storage</span>
            </a>
            <a href="/order/create" class="nav-link">
              <i data-feather="plus-circle"></i><span>Create New Order</span>
            </a>
            <a href="/stocktaking" class="nav-link">
              <i data-feather="archive"></i><span>Stocktaking</span>
            </a>
            <a href="/logistics" class="nav-link active">
              <i data-feather="truck"></i><span>Logistics</span>
            </a>
            <a href="/funds" class="nav-link">
              <i data-feather="dollar-sign"></i><span>Funds</span>
            </a>
          </nav>
        </div>
        <div class="sidebar__bottom">
          <a href="/logout" class="btn btn-ghost">
            <i data-feather="log-out"></i><span>Logout</span>
          </a>
        </div>
      </aside>

      <!-- ===== Main ===== -->
      <main class="main">
        <!-- Header hello + search -->
        <div class="page-head">
          <div class="hello-box">
            <div class="hello-title">Hi, <span id="hello-name">...</span> 👋</div>
            <div class="hello-sub">Your logistics overview</div>
          </div>
          <div class="search-box">
            <i data-feather="search"></i>
            <input id="search" class="search-input" type="search" placeholder="Search items for logistics..." />
          </div>
        </div>

        <!-- ===== Top bar as tabs (بظل للتبويب النشط) ===== -->
        <div class="tabs-bar" role="tablist" aria-label="Logistics filters">
          <button id="lg-btn-prepared"
                  class="tab-card"
                  role="tab" aria-selected="true" aria-pressed="true"
                  data-filter="prepared">
            <div class="tab-title">Fully prepared</div>
            <div class="tab-value" id="lg-prepared">0</div>
          </button>

          <button id="lg-btn-received"
                  class="tab-card"
                  role="tab" aria-selected="false" aria-pressed="false"
                  data-filter="received">
            <div class="tab-title">Received</div>
            <div class="tab-value" id="lg-received">0</div>
          </button>

          <button id="lg-btn-delivered"
                  class="tab-card"
                  role="tab" aria-selected="false" aria-pressed="false"
                  data-filter="delivered">
            <div class="tab-title">Delivered</div>
            <div class="tab-value" id="lg-delivered">0</div>
          </button>
        </div>

        <!-- Grid: orders/cards -->
        <section id="logistics-grid" class="cards-grid"></section>

        <!-- Empty state -->
        <div id="logistics-empty" class="empty-state" style="display:none">
          <div class="empty-title">No items.</div>
          <div class="empty-sub">There are no orders to show here right now.</div>
        </div>

        <!-- (اختياري) popover للمدخلات الجزئية إن لزم -->
        <div id="partial-popover" class="popover hidden" role="dialog" aria-modal="true" aria-label="Edit">
          <div class="popover__body">
            <div class="form-row">
              <label class="form-label">Available</label>
              <input id="popover-input" type="number" min="0" class="form-input" />
              <div id="popover-hint" class="form-hint"></div>
            </div>
            <div class="popover__actions">
              <button class="btn" data-pop="cancel">Cancel</button>
              <button class="btn btn-primary" data-pop="save">Save</button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Page script -->
    <script src="/js/logistics.js"></script>
    <script>
      // Feather icons
      window.feather && feather.replace({ 'stroke-width': 2 });

      // تفعيل التبويب بصريًا + مزامنة الـ URL + إبلاغ logistics.js
      (function () {
        const btns = [
          document.getElementById('lg-btn-prepared'),
          document.getElementById('lg-btn-received'),
          document.getElementById('lg-btn-delivered')
        ];
        function setActive(btn){
          btns.forEach(b=>{
            if(!b) return;
            const on = b===btn;
            b.classList.toggle('active', on);
            b.setAttribute('aria-selected', on ? 'true' : 'false');
            b.setAttribute('aria-pressed',  on ? 'true' : 'false');
          });
        }
        btns.forEach(b=>{
          if(!b) return;
          b.addEventListener('click', ()=>{
            setActive(b);
            const tab = b.getAttribute('data-filter') || '';
            const url = new URL(location.href);
            url.searchParams.set('tab', tab);
            history.replaceState({}, '', url);
            window.dispatchEvent(new CustomEvent('logistics:set-filter-from-tab',{detail:{tab}}));
          });
        });

        // فعل التبويب من ?tab= في الرابط لو موجود
        const initial = (new URLSearchParams(location.search).get('tab')||'prepared').toLowerCase();
        const map = {prepared:'lg-btn-prepared', received:'lg-btn-received', delivered:'lg-btn-delivered'};
        const first = document.getElementById(map[initial]) || btns[0];
        first && first.click(); // يضبط الفلتر ويشغّل الحدث
      })();
    </script>
  </body>
</html>